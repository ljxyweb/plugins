!function(i){"use strict";function t(i){this.img=null,this.origin_img=null,this.uploadBox=null,this.options={msg:"点击添加图片"},this.el=i.el;for(var t in i)i.hasOwnProperty(t)&&(this.options[t]=i[t]);this.initWidget(),this.addEvents()}t.prototype={initWidget:function(){var i=this.el.parentNode;this.uploadBox=document.createElement("div"),this.uploadBox.innerHTML=this.options.msg;var t=document.createElement("div");this.uploadBox.className="but-upload",t.className="uploadbox",t.appendChild(this.uploadBox),this.uploadBox.appendChild(this.el),i.appendChild(t)},addEvents:function(){var i=this,t=function(){var t=this.files;if(t)for(var e=0;e<t.length;e++)i.previewImage(t[e]);else i.previewImageUnderIE9()};this.el.addEventListener?this.el.addEventListener("change",t,!1):this.el.attachEvent?this.el.attachEvent("onchange",t):this.el.onchange=t},previewImage:function(i){var t=/image.*/,e=this;if(i.type.match(t)){this.img||(this.img=document.createElement("img"),this.img.className="but-img",this.uploadBox.insertBefore(this.img,this.el)),this.img.file=i;var s=new FileReader;s.onload=function(i){return function(t){i.src=t.target.result,i.onload=function(){e.autoSizePreview(this.naturalWidth,this.naturalHeight)}}}(this.img),s.readAsDataURL(i)}else alert("File Type must be an image")},previewImageUnderIE9:function(){this.el.select();var i=document.selection.createRange().text,t=i.substring(i.lastIndexOf(".")+1).toLowerCase();if("png"==t||"jpg"==t||"jpeg"==t||"gif"==t){this.img||(this.origin_img=document.createElement("img"),this.uploadBox.insertBefore(this.origin_img,this.el),this.origin_img.style.cssText="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image);visibility:hidden;position:absolute;top:0;left:0;",this.img=document.createElement("img"),this.img.className="but-img",this.uploadBox.insertBefore(this.img,this.el),this.img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)");try{this.img.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=i,this.origin_img.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=i,this.autoSizePreview(this.origin_img.offsetWidth,this.origin_img.offsetHeight)}catch(i){alert("您上传的图片格式不正确，请重新选择!")}document.selection.empty()}else alert("File Type must be an image")},autoSizePreview:function(i,t){var e=this.clacImgZoomParam(this.el.offsetWidth,this.el.offsetHeight,i,t);this.img.style.width=e.width+"px",this.img.style.height=e.height+"px",this.img.style.marginTop=e.top+"px",this.img.style.marginLeft=e.left+"px"},clacImgZoomParam:function(i,t,e,s){var a,o,n={width:e,height:s,top:0,left:0};return(e>i||s>t)&&((a=e/i)>(o=s/t)?(n.width=i,n.height=s/a):(n.width=e/o,n.height=t)),n.left=(i-n.width)/2,n.top=(t-n.height)/2,n}},i.PreviewPicture=i.PreviewPicture||t}(window);